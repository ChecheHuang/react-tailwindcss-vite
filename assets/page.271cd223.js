import{r as s,al as c,am as T,an as W,a,h as N,j as v,ao as M,ap as U,a1 as o,aq as B,ar as q}from"./react-select.esm.90a3a7d9.js";const H=d=>{const[g,l]=s.exports.useState(d);return{inputProps:{value:g,onChange:i=>{l(i.target.value)}},reset:()=>{l(d)},setInput:i=>l(i)}};c.fabric.Object.prototype.cornerStyle="circle";const G=()=>{const d=T().fileId,[g,l]=s.exports.useState(!1),p=s.exports.useRef(null),[e,x]=s.exports.useState(null),i=s.exports.useRef(null),{inputProps:C,reset:j}=H(""),[D,F]=s.exports.useState(!1),[h,w]=s.exports.useState(!1),[A,b]=s.exports.useState({fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400}),E=W.exports.useReactToPrint({content:()=>p.current}),I=()=>{!e||(e.add(new c.fabric.IText(C.value,{fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400,backgroundColor:"white"})),l(!1),j())},O=t=>{y("fontFamily",t),b(n=>({...n,fontFamily:t}))},P=t=>{y("fontWeight",t),b(n=>({...n,fontWeight:t}))},y=(t,n)=>{if(!e)return;const r=e.getActiveObject();r&&r instanceof c.fabric.IText&&(r.set(t,n),e.renderAll())},m=s.exports.useCallback(()=>{if(!e)return;const t=e.getActiveObject();t&&(e.remove(t),e.renderAll())},[e]),$=()=>{!e||e.add(new c.fabric.IText(new Date().toLocaleString(),{fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400,fontSize:14,backgroundColor:"white",top:20,left:830}))},z=()=>{const t="hotpink",r=()=>{const u=`
		<svg
			height="${30}"
			fill="${t}"
			viewBox="0 0 ${60} ${60}"
			width="${30}"
			xmlns="http://www.w3.org/2000/svg"
		>
			<circle
				cx="50%"
				cy="50%"
				r="${30}" 
			/>
		</svg>
	`;return`data:image/svg+xml;base64,${window.btoa(u)}`};!e||(e.freeDrawingBrush=new c.fabric.PencilBrush(e),e.freeDrawingBrush.width=20,e.freeDrawingBrush.color="white",e.freeDrawingCursor=`url(${r()}) ${30/2} ${30/2}, crosshair`,e.isDrawingMode=!e.isDrawingMode,F(!D))},L=()=>{if(!e)return;const t=e.toDataURL(),n=document.createElement("a");n.href=t,n.download="image.png",n.click()};return s.exports.useEffect(()=>{const t="https://images.pexels.com/photos/434341/pexels-photo-434341.jpeg?auto=compress&cs=tinysrgb&w=600";return c.fabric.Image.fromURL(t,n=>{const{height:r,width:u}=n;if(!r||!u){console.error("Failed to load image!");return}const S=1e3/u,k=u*S,R=r*S;n.scaleToWidth(k);const f=new c.fabric.Canvas(i.current,{width:k,height:R});f.setBackgroundImage(n,f.renderAll.bind(f)),x(f)}),()=>{}},[d]),s.exports.useEffect(()=>{if(!!e)return e.on("mouse:down",()=>{const t=e.getActiveObject();if(!t)return;const{fontFamily:n,fontWeight:r}=t;w(!0),b({fontFamily:n,fontWeight:r})}),e.on("selection:cleared",()=>{w(!1)}),e.on("object:added",t=>{const n=t.target;n&&(e.setActiveObject(n),w(!0))}),()=>{e.off("mouse:down"),e.off("selection:cleared")}},[e]),s.exports.useEffect(()=>{const t=n=>{n.key==="Delete"&&m()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[m]),a(N,{children:v("div",{className:"mt-2 flex w-full flex-col flex-wrap items-center",children:[v("div",{className:"flex  flex-wrap gap-2 p-2",children:[a(M,{trigger:"click",open:g,onOpenChange:t=>{l(t)},content:v("div",{className:"flex gap-2",children:[a(U,{...C,className:" w-28"}),a(o,{onClick:I,type:"primary",children:"\u78BA\u5B9A"})]}),children:a(o,{type:"primary",children:"\u65B0\u589E\u6587\u5B57"})}),a(B,{disabled:!h,placeholder:"\u9078\u64C7\u5B57\u9AD4",className:"w-28",...h&&{value:A.fontFamily},onChange:O,options:[{value:"\u6A19\u6977\u9AD4",label:"\u6A19\u6977\u9AD4"},{value:"\u65B0\u7D30\u660E\u9AD4",label:"\u65B0\u7D30\u660E\u9AD4"}]}),a(B,{disabled:!h,placeholder:"\u9078\u64C7\u7C97\u7D30",className:"w-28",...h&&{value:A.fontWeight},onChange:P,options:[{value:400,label:"\u6B63\u5E38"},{value:700,label:"\u7C97\u9AD4"}]}),a(o,{type:D?"primary":"default",onClick:()=>z(),children:a(q,{})}),a(o,{onClick:$,children:"\u589E\u52A0\u65E5\u671F"}),a(o,{onClick:m,children:"\u522A\u9664"}),a(o,{onClick:E,children:"\u5217\u5370"}),a(o,{onClick:L,children:"\u4E0B\u8F09"})]}),a("div",{className:"flex w-full justify-center ",ref:p,children:a("canvas",{ref:i})})]})})};export{G as default};
