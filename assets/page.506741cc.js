import{r as n,c4 as c,ag as T,c5 as W,j as s,h as N,a as m,c6 as M,Y as U,w as o,a6 as B,c7 as H}from"./index.32b7d652.js";const K=p=>{const[f,i]=n.exports.useState(p);return{inputProps:{value:f,onChange:l=>{i(l.target.value)}},reset:()=>{i(p)},setInput:l=>i(l)}};c.fabric.Object.prototype.cornerStyle="circle";const q=()=>{const p=T().fileId,[f,i]=n.exports.useState(!1),g=n.exports.useRef(null),[e,x]=n.exports.useState(null),l=n.exports.useRef(null),{inputProps:C,reset:j}=K(""),[D,F]=n.exports.useState(!1),[d,v]=n.exports.useState(!1),[A,w]=n.exports.useState({fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400}),E=W.exports.useReactToPrint({content:()=>g.current}),I=()=>{!e||(e.add(new c.fabric.IText(C.value,{fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400,backgroundColor:"white"})),i(!1),j())},O=t=>{y("fontFamily",t),w(a=>({...a,fontFamily:t}))},P=t=>{y("fontWeight",t),w(a=>({...a,fontWeight:t}))},y=(t,a)=>{if(!e)return;const r=e.getActiveObject();r&&r instanceof c.fabric.IText&&(r.set(t,a),e.renderAll())},b=n.exports.useCallback(()=>{if(!e)return;const t=e.getActiveObject();t&&(e.remove(t),e.renderAll())},[e]),$=()=>{!e||e.add(new c.fabric.IText(new Date().toLocaleString(),{fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400,fontSize:14,backgroundColor:"white",top:20,left:830}))},z=()=>{const t="hotpink",r=()=>{const u=`
		<svg
			height="${30}"
			fill="${t}"
			viewBox="0 0 ${60} ${60}"
			width="${30}"
			xmlns="http://www.w3.org/2000/svg"
		>
			<circle
				cx="50%"
				cy="50%"
				r="${30}" 
			/>
		</svg>
	`;return`data:image/svg+xml;base64,${window.btoa(u)}`};!e||(e.freeDrawingBrush=new c.fabric.PencilBrush(e),e.freeDrawingBrush.width=20,e.freeDrawingBrush.color="white",e.freeDrawingCursor=`url(${r()}) ${30/2} ${30/2}, crosshair`,e.isDrawingMode=!e.isDrawingMode,F(!D))},L=()=>{if(!e)return;const t=e.toDataURL(),a=document.createElement("a");a.href=t,a.download="image.png",a.click()};return n.exports.useEffect(()=>{const t="https://images.pexels.com/photos/434341/pexels-photo-434341.jpeg?auto=compress&cs=tinysrgb&w=600";return c.fabric.Image.fromURL(t,a=>{const{height:r,width:u}=a;if(!r||!u){console.error("Failed to load image!");return}const S=1e3/u,k=u*S,R=r*S;a.scaleToWidth(k);const h=new c.fabric.Canvas(l.current,{width:k,height:R});h.setBackgroundImage(a,h.renderAll.bind(h)),x(h)}),()=>{}},[p]),n.exports.useEffect(()=>{if(!!e)return e.on("mouse:down",()=>{const t=e.getActiveObject();if(!t)return;const{fontFamily:a,fontWeight:r}=t;v(!0),w({fontFamily:a,fontWeight:r})}),e.on("selection:cleared",()=>{v(!1)}),e.on("object:added",t=>{const a=t.target;a&&(e.setActiveObject(a),v(!0))}),()=>{e.off("mouse:down"),e.off("selection:cleared")}},[e]),n.exports.useEffect(()=>{const t=a=>{a.key==="Delete"&&b()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[b]),s(N,{children:m("div",{"data-inspector-line":"203","data-inspector-column":"6","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",className:"mt-2 flex w-full flex-col flex-wrap items-center",children:[m("div",{"data-inspector-line":"204","data-inspector-column":"8","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",className:"flex  flex-wrap gap-2 p-2",children:[s(M,{"data-inspector-line":"205","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",trigger:"click",open:f,onOpenChange:t=>{i(t)},content:m("div",{"data-inspector-line":"212","data-inspector-column":"14","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",className:"flex gap-2",children:[s(U,{"data-inspector-line":"213","data-inspector-column":"16","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",...C,className:" w-28"}),s(o,{"data-inspector-line":"214","data-inspector-column":"16","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",onClick:I,type:"primary",children:"\u78BA\u5B9A"})]}),children:s(o,{"data-inspector-line":"220","data-inspector-column":"12","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",type:"primary",children:"\u65B0\u589E\u6587\u5B57"})}),s(B,{"data-inspector-line":"222","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",disabled:!d,placeholder:"\u9078\u64C7\u5B57\u9AD4",className:"w-28",...d&&{value:A.fontFamily},onChange:O,options:[{value:"\u6A19\u6977\u9AD4",label:"\u6A19\u6977\u9AD4"},{value:"\u65B0\u7D30\u660E\u9AD4",label:"\u65B0\u7D30\u660E\u9AD4"}]}),s(B,{"data-inspector-line":"233","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",disabled:!d,placeholder:"\u9078\u64C7\u7C97\u7D30",className:"w-28",...d&&{value:A.fontWeight},onChange:P,options:[{value:400,label:"\u6B63\u5E38"},{value:700,label:"\u7C97\u9AD4"}]}),s(o,{"data-inspector-line":"244","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",type:D?"primary":"default",onClick:()=>z(),children:s(H,{"data-inspector-line":"248","data-inspector-column":"12","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx"})}),s(o,{"data-inspector-line":"250","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",onClick:$,children:"\u589E\u52A0\u65E5\u671F"}),s(o,{"data-inspector-line":"251","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",onClick:b,children:"\u522A\u9664"}),s(o,{"data-inspector-line":"252","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",onClick:E,children:"\u5217\u5370"}),s(o,{"data-inspector-line":"253","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",onClick:L,children:"\u4E0B\u8F09"})]}),s("div",{"data-inspector-line":"255","data-inspector-column":"8","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",className:"flex w-full justify-center ",ref:g,children:s("canvas",{"data-inspector-line":"256","data-inspector-column":"10","data-inspector-relative-path":"src\\views\\tools\\fabric\\page.tsx",ref:l})})]})})};export{q as default};
