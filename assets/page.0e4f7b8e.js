import{r,bO as c,af as L,bP as T,j as s,h as N,a as v,bQ as M,W as U,v as o,a5 as B,bR as H}from"./index.a5be5315.js";const K=d=>{const[g,l]=r.exports.useState(d);return{inputProps:{value:g,onChange:i=>{l(i.target.value)}},reset:()=>{l(d)},setInput:i=>l(i)}};c.fabric.Object.prototype.cornerStyle="circle";const q=()=>{const d=L().fileId,[g,l]=r.exports.useState(!1),p=r.exports.useRef(null),[e,x]=r.exports.useState(null),i=r.exports.useRef(null),{inputProps:C,reset:j}=K(""),[D,F]=r.exports.useState(!1),[h,b]=r.exports.useState(!1),[A,w]=r.exports.useState({fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400}),E=T.exports.useReactToPrint({content:()=>p.current}),I=()=>{!e||(e.add(new c.fabric.IText(C.value,{fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400,backgroundColor:"white"})),l(!1),j())},O=t=>{y("fontFamily",t),w(n=>({...n,fontFamily:t}))},P=t=>{y("fontWeight",t),w(n=>({...n,fontWeight:t}))},y=(t,n)=>{if(!e)return;const a=e.getActiveObject();a&&a instanceof c.fabric.IText&&(a.set(t,n),e.renderAll())},m=r.exports.useCallback(()=>{if(!e)return;const t=e.getActiveObject();t&&(e.remove(t),e.renderAll())},[e]),$=()=>{!e||e.add(new c.fabric.IText(new Date().toLocaleString(),{fontFamily:"\u6A19\u6977\u9AD4",fontWeight:400,fontSize:14,backgroundColor:"white",top:20,left:830}))},z=()=>{const t="hotpink",a=()=>{const u=`
		<svg
			height="${30}"
			fill="${t}"
			viewBox="0 0 ${60} ${60}"
			width="${30}"
			xmlns="http://www.w3.org/2000/svg"
		>
			<circle
				cx="50%"
				cy="50%"
				r="${30}" 
			/>
		</svg>
	`;return`data:image/svg+xml;base64,${window.btoa(u)}`};!e||(e.freeDrawingBrush=new c.fabric.PencilBrush(e),e.freeDrawingBrush.width=20,e.freeDrawingBrush.color="white",e.freeDrawingCursor=`url(${a()}) ${30/2} ${30/2}, crosshair`,e.isDrawingMode=!e.isDrawingMode,F(!D))},R=()=>{if(!e)return;const t=e.toDataURL(),n=document.createElement("a");n.href=t,n.download="image.png",n.click()};return r.exports.useEffect(()=>{const t="https://images.pexels.com/photos/434341/pexels-photo-434341.jpeg?auto=compress&cs=tinysrgb&w=600";return c.fabric.Image.fromURL(t,n=>{const{height:a,width:u}=n;if(!a||!u){console.error("Failed to load image!");return}const S=1e3/u,k=u*S,W=a*S;n.scaleToWidth(k);const f=new c.fabric.Canvas(i.current,{width:k,height:W});f.setBackgroundImage(n,f.renderAll.bind(f)),x(f)}),()=>{}},[d]),r.exports.useEffect(()=>{if(!!e)return e.on("mouse:down",()=>{const t=e.getActiveObject();if(!t)return;const{fontFamily:n,fontWeight:a}=t;b(!0),w({fontFamily:n,fontWeight:a})}),e.on("selection:cleared",()=>{b(!1)}),e.on("object:added",t=>{const n=t.target;n&&(e.setActiveObject(n),b(!0))}),()=>{e.off("mouse:down"),e.off("selection:cleared")}},[e]),r.exports.useEffect(()=>{const t=n=>{n.key==="Delete"&&m()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[m]),s(N,{children:v("div",{className:"mt-2 flex w-full flex-col flex-wrap items-center",children:[v("div",{className:"flex  flex-wrap gap-2 p-2",children:[s(M,{trigger:"click",open:g,onOpenChange:t=>{l(t)},content:v("div",{className:"flex gap-2",children:[s(U,{...C,className:" w-28"}),s(o,{onClick:I,type:"primary",children:"\u78BA\u5B9A"})]}),children:s(o,{type:"primary",children:"\u65B0\u589E\u6587\u5B57"})}),s(B,{disabled:!h,placeholder:"\u9078\u64C7\u5B57\u9AD4",className:"w-28",...h&&{value:A.fontFamily},onChange:O,options:[{value:"\u6A19\u6977\u9AD4",label:"\u6A19\u6977\u9AD4"},{value:"\u65B0\u7D30\u660E\u9AD4",label:"\u65B0\u7D30\u660E\u9AD4"}]}),s(B,{disabled:!h,placeholder:"\u9078\u64C7\u7C97\u7D30",className:"w-28",...h&&{value:A.fontWeight},onChange:P,options:[{value:400,label:"\u6B63\u5E38"},{value:700,label:"\u7C97\u9AD4"}]}),s(o,{type:D?"primary":"default",onClick:()=>z(),children:s(H,{})}),s(o,{onClick:$,children:"\u589E\u52A0\u65E5\u671F"}),s(o,{onClick:m,children:"\u522A\u9664"}),s(o,{onClick:E,children:"\u5217\u5370"}),s(o,{onClick:R,children:"\u4E0B\u8F09"})]}),s("div",{className:"flex w-full justify-center ",ref:p,children:s("canvas",{ref:i})})]})})};export{q as default};
